<?php
if (!defined("FUNC_FILE")) die("Illegal File Access");

class Date_DeltaRussian { function date_lang () {$intervals = array( "seconds"=>explode(',',_TIME_SEC), "minutes"=>explode(',',_TIME_MIN), "hours"=>explode(',',_TIME_HOU), "mday"=>explode(',',_TIME_DAY),  "mon"=>explode(',',_TIME_MON), "year"=>explode(',',_TIME_YEA) ); return $intervals;} var $from = "seconds"; function Date_DeltaRussian($from = "seconds") { $this->from = $from; } function getDelta( $first,$last,$max) { if ($last < $first) return false; $hms = ($last - $first) % (3600 * 24); $last -= $hms; $f = getdate($first); $l = getdate($last); $dYear = $dMon = $dDay = 0; $dDay += $l['mday'] - $f['mday']; if ($dDay < 0) {$monlen = Date_DeltaRussian::monthLength(date("Y", $first), date("m", $first));$dDay += $monlen;$dMon--;} $dMon += $l['mon'] - $f['mon']; if ($dMon < 0) {$dMon += 12;$dYear --;} $dYear += $l['year'] - $f['year']; $delta['year'] = $dYear; $delta['mon'] = $dMon; $delta['mday'] = $dDay; $delta['hours']   = floor($hms/3600) % 60; $delta['minutes'] = floor($hms/60) % 60; $delta[ 'seconds'] = $hms % 60; return $delta; } function spellDelta($first,$last,$max) { $delta = $this->getDelta($first,$last,$max); if (!$delta) return false; $parts = array(); foreach ($delta as $k=>$n) { if (!$n) continue; $intervals=$this->date_lang(); $parts[] = Date_DeltaRussian::declension($n, $intervals[$k]); if ($this->from && $k == $this->from) break; } array_splice($parts,$max); return join(" " , $parts); } function monthLength($year, $mon) { $l = 28; while (checkdate($mon, $l+1, $year)) $l++; return $l; } function declension($int, $expressions) {settype($int, "integer"); $count = $int % 100; if ($count >= 5 && $count <= 20) { $result = $int." ".$expressions['2']; } else { $count = $count % 10; if ($count == 1) { $result = $int." ".$expressions['0']; } elseif ($count >= 2 && $count <= 4) { $result = $int." ".$expressions['1']; } else { $result = $int." ".$expressions['2']; } } return $result; } } 
?>